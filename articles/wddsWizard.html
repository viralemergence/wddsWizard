<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started • wddsWizard</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">wddsWizard</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/wddsWizard.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/disease_data.html">Wildlife Disease Data</a></li>
    <li><a class="dropdown-item" href="../articles/extending_wdds.html">Extending the Wildlife Disease Data Standard</a></li>
    <li><a class="dropdown-item" href="../articles/project_metadata.html">Project Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/schema_overview.html">Schema Overview</a></li>
    <li><a class="dropdown-item" href="../articles/wdds_to_pharos.html">WDDS to Pharos</a></li>
    <li><a class="dropdown-item" href="../articles/wdds_to_zenodo.html">WDDS to Zenodo</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/viralemergence/wddsWizard/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/viralemergence/wddsWizard/blob/main/vignettes/wddsWizard.Rmd" class="external-link"><code>vignettes/wddsWizard.Rmd</code></a></small>
      <div class="d-none name"><code>wddsWizard.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://viralemergence.github.io/wddsWizard/">wddsWizard</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/jsonvalidate/" class="external-link">jsonvalidate</a></span><span class="op">)</span></span></code></pre></div>
<p>This package is home to the <a href="https://doi.org/10.32942/X2TW4J" class="external-link">Wildlife Disease Data
Standard</a>. It provides template csv files for storing data and a set
of functions for validating datasets against the standard.</p>
<div class="section level2">
<h2 id="the-whole-game">The Whole game<a class="anchor" aria-label="anchor" href="#the-whole-game"></a>
</h2>
<p>Flat data files (csv/xlsx) are imported into R, lightly restructured,
and then converted to JSON and validated against the Wildlife Disease
Data Standard. Data sets either pass (🎉) or fail with informative
errors.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>The data standard is designed to be flexible and accessible. It is
composed of two components: disease data and project metadata. The
disease data component describes the contents and structure of data
related to the detection (or not) of a parasite in a given host. The
project metadata component describes the contents and structure of data
related to the creation of the disease data component. The disease data
component allows us to create a collection of datasets that can be
re-used, aggregated, and shared, while the project metadata component
provides context for the data, makes it easier to find the dataset, and
gives clear information about attribution and use (rights/license).</p>
<p>Using this package, you can validate one or both components of the
data standard. It will be helpful to open the <a href="schema_overview.html#terms">Data Standard Terms</a> in a separate
browser tab as you go through the vignette and explore templates.</p>
<p>If you use the templates provided, you can focus on the field
descriptions and largely ignore types and array items.</p>
<div class="section level3">
<h3 id="templates">Templates<a class="anchor" aria-label="anchor" href="#templates"></a>
</h3>
<p>We have created several templates to make it easier to get started
using the Wildlife Disease Data Standard.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list templates</span></span>
<span><span class="fu"><a href="../reference/use_wdds_template.html">use_wdds_template</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Provide a value to `template_file` to use the template</span></span>
<span><span class="co">#&gt; [1] "disease_data_template.csv"     "disease_data_template.xlsx"   </span></span>
<span><span class="co">#&gt; [3] "project_metadata_template.csv"</span></span></code></pre></div>
<p>You can make your own copies of the template files with the
<code>use_wdds_template</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/use_wdds_template.html">use_wdds_template</a></span><span class="op">(</span><span class="st">"disease_data_template.csv"</span>, file_name <span class="op">=</span> <span class="st">"my_interesting_disease_data.csv"</span>, open <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/use_wdds_template.html">use_wdds_template</a></span><span class="op">(</span><span class="st">"project_metadata_template.csv"</span>, file_name <span class="op">=</span> <span class="st">"my_project_metadata.csv"</span>, open <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The templates may contain additional fields that are not strictly
required. Required fields are clearly marked in <a href="schema_overview.html#terms">Data Standard Terms</a>
documentation.</p>
<p>The following fields are required for disease data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">wddsWizard</span><span class="fu">::</span><span class="va"><a href="../reference/disease_data_required_fields.html">disease_data_required_fields</a></span></span>
<span><span class="co">#&gt; [1] "sampleID"               "latitude"               "longitude"             </span></span>
<span><span class="co">#&gt; [4] "sampleCollectionMethod" "hostIdentification"     "detectionTarget"       </span></span>
<span><span class="co">#&gt; [7] "detectionMethod"        "detectionOutcome"       "parasiteIdentification"</span></span></code></pre></div>
<p>The following fields are required for project metadata:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">wddsWizard</span><span class="fu">::</span><span class="va"><a href="../reference/project_metadata_required_fields.html">project_metadata_required_fields</a></span></span>
<span><span class="co">#&gt; [1] "methodology"       "creators"          "titles"           </span></span>
<span><span class="co">#&gt; [4] "publicationYear"   "language"          "descriptions"     </span></span>
<span><span class="co">#&gt; [7] "fundingReferences"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="disease-data">Disease Data<a class="anchor" aria-label="anchor" href="#disease-data"></a>
</h3>
<p>Disease data are expected to be in a “tidy” form (think CSV or XLS
where each row is an observation and each column is a property). Each
column in the table that is part of the standard will be validated. You
may include additional columns as needed.</p>
<p>Disease data and project metadata can be validated separately. In the
code below we will read in a csv file, do some light wrangling,
transform the data to JSON, and then validate the data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## read in the data</span></span>
<span><span class="va">my_disease_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wdds_example_data.html">wdds_example_data</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"latest"</span>, file <span class="op">=</span> <span class="st">"my_interesting_disease_data.csv"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clean up field names to match JSON schema</span></span>
<span><span class="va">my_disease_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_field_names.html">clean_field_names</a></span><span class="op">(</span><span class="va">my_disease_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Check for required Fields -</span></span>
<span></span>
<span><span class="co"># check that all required fields are in the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu">wddsWizard</span><span class="fu">::</span><span class="va"><a href="../reference/disease_data_required_fields.html">disease_data_required_fields</a></span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_disease_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co">## Prep for JSON</span></span>
<span></span>
<span><span class="va">my_disease_data_prepped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_data.html">prep_data</a></span><span class="op">(</span><span class="va">my_disease_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## make the JSON!</span></span>
<span><span class="va">my_disease_data_json</span> <span class="op">&lt;-</span> <span class="va">my_disease_data_prepped</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### validate the JSON</span></span>
<span></span>
<span><span class="co"># get the schema file</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wdds_json.html">wdds_json</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"latest"</span>, file <span class="op">=</span> <span class="st">"schemas/disease_data.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this creates a function that we can use to validate our data</span></span>
<span><span class="va">dd_validator</span> <span class="op">&lt;-</span> <span class="fu">jsonvalidate</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/jsonvalidate/reference/json_validator.html" class="external-link">json_validator</a></span><span class="op">(</span><span class="va">schema</span>, engine <span class="op">=</span> <span class="st">"ajv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use the validator to check if the disease data conforms to the disease_data component of the standard</span></span>
<span><span class="va">dd_validation</span> <span class="op">&lt;-</span> <span class="fu">dd_validator</span><span class="op">(</span><span class="va">my_disease_data_json</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## check for errors!</span></span>
<span></span>
<span><span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">dd_validation</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">dd_validation</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">errors</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Valid disease data!😁"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Valid disease data!😁"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="project-metadata">Project Metadata<a class="anchor" aria-label="anchor" href="#project-metadata"></a>
</h3>
<p>Project metadata largely follow the <a href="https://datacite-metadata-schema.readthedocs.io/en/4.5/" class="external-link">Datacite
Metadata Schema</a>. Again, the data standard allows you to include
additional properties.</p>
<p>Note that if you are comfortable with JSON, it may be easier to write
project metadata directly as JSON.</p>
<p>In the example below, we will use project metadata created from the
project metadata template to create JSON that can be validated against
the project metadata component of the data standard.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in project metadata created from template</span></span>
<span></span>
<span><span class="va">my_project_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wdds_example_data.html">wdds_example_data</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"latest"</span>, file <span class="op">=</span> <span class="st">"my_project_metadata.csv"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare project metadata</span></span>
<span><span class="va">my_project_metadata_prepped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_from_metadata_template.html">prep_from_metadata_template</a></span><span class="op">(</span><span class="va">my_project_metadata</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># check that all required fields are in the project metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu">wddsWizard</span><span class="fu">::</span><span class="va"><a href="../reference/project_metadata_required_fields.html">project_metadata_required_fields</a></span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_project_metadata_prepped</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># convert to json</span></span>
<span></span>
<span><span class="va">my_project_metadata_json</span> <span class="op">&lt;-</span> <span class="va">my_project_metadata_prepped</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># validate against project metadata schema</span></span>
<span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wdds_json.html">wdds_json</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"latest"</span>, file <span class="op">=</span> <span class="st">"schemas/project_metadata.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pm_validator</span> <span class="op">&lt;-</span> <span class="fu">jsonvalidate</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/jsonvalidate/reference/json_validator.html" class="external-link">json_validator</a></span><span class="op">(</span><span class="va">schema</span>, engine <span class="op">=</span> <span class="st">"ajv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pm_validation</span> <span class="op">&lt;-</span> <span class="fu">pm_validator</span><span class="op">(</span><span class="va">my_project_metadata_json</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## check for errors!</span></span>
<span></span>
<span><span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">pm_validation</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">pm_validation</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">errors</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Valid project metadata!😁"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Valid project metadata!😁"</span></span></code></pre></div>
<p>See the vignettes on <a href="project_metadata.html">Project
Metadata</a> and <a href="disease_data.html">Wildlife Disease Data</a>
for more details on preparing those components.</p>
</div>
</div>
<div class="section level2">
<h2 id="combine-disease-data-and-project-metadata">Combine disease data and project metadata<a class="anchor" aria-label="anchor" href="#combine-disease-data-and-project-metadata"></a>
</h2>
<p>Finally we will check the disease data and the project metadata
against the standard.</p>
<div class="section level3">
<h3 id="combine-components">Combine components<a class="anchor" aria-label="anchor" href="#combine-components"></a>
</h3>
<p>The first thing we have to do is combine the disease data and project
metadata components in a list and check that we have all the required
fields.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## use append so that you do not add levels to your list</span></span>
<span></span>
<span><span class="va">data_package</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  disease_data <span class="op">=</span> <span class="va">my_disease_data_prepped</span>,</span>
<span>  project_metadata <span class="op">=</span> <span class="va">my_project_metadata_prepped</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check that all required fields are in the data</span></span>
<span></span>
<span><span class="va">req_field_check</span> <span class="op">&lt;-</span> <span class="fu">wddsWizard</span><span class="fu">::</span><span class="va"><a href="../reference/schema_required_fields.html">schema_required_fields</a></span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_package</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">!</span><span class="va">req_field_check</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">wddsWizard</span><span class="fu">::</span><span class="va"><a href="../reference/schema_required_fields.html">schema_required_fields</a></span><span class="op">[</span><span class="op">!</span><span class="va">req_field_check</span><span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"all required fields present 🥳"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "all required fields present 🥳"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="make-json">Make JSON<a class="anchor" aria-label="anchor" href="#make-json"></a>
</h3>
<p>Next we will convert the <code>data_package</code> so that it can be
validated.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert to json</span></span>
<span></span>
<span><span class="va">data_package_json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">data_package</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="validate-your-json">Validate your json!<a class="anchor" aria-label="anchor" href="#validate-your-json"></a>
</h3>
<p>Here we will use the {jsonvalidate} package to make sure
<code>data_package_json</code> conforms to the wildlife disease data
standard.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wdds_json.html">wdds_json</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"latest"</span>, file <span class="op">=</span> <span class="st">"wdds_schema.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wdds_validator</span> <span class="op">&lt;-</span> <span class="fu">jsonvalidate</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/jsonvalidate/reference/json_validator.html" class="external-link">json_validator</a></span><span class="op">(</span><span class="va">schema</span>, engine <span class="op">=</span> <span class="st">"ajv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">project_validation</span> <span class="op">&lt;-</span> <span class="fu">wdds_validator</span><span class="op">(</span><span class="va">data_package_json</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">project_validation</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Your data package is valid! 🎊 "</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">errors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">project_validation</span><span class="op">)</span></span>
<span>  <span class="va">errors</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Your data package is valid! 🎊 "</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="handling-errors">Handling Errors<a class="anchor" aria-label="anchor" href="#handling-errors"></a>
</h3>
<p>You’re likely going to get some errors and interpretting them can
sometimes be a challenge.</p>
<p>Lets dive in by modifying the data_package to create a known
issue.</p>
<p>Looking at the data standard, we can see that <code>language</code>
is type: string.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the properly formatted language property should like this:</span></span>
<span><span class="va">data_package</span><span class="op">$</span><span class="va">project_metadata</span><span class="op">[</span><span class="st">"language"</span><span class="op">]</span><span class="op">|&gt;</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "language": "en"</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># lets make language a multi-row data frame</span></span>
<span><span class="va">data_package_error_lang</span> <span class="op">&lt;-</span> <span class="va">data_package</span></span>
<span></span>
<span><span class="va">data_package_error_lang</span><span class="op">$</span><span class="va">project_metadata</span><span class="op">$</span><span class="va">language</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>language <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"en"</span>,<span class="st">"fr"</span>,<span class="st">"cn"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">data_package_error_lang</span><span class="op">$</span><span class="va">project_metadata</span><span class="op">[</span><span class="st">"language"</span><span class="op">]</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "language": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "language": "en"</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "language": "fr"</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "language": "cn"</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   ]</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>Our new version of language is an array of objects - square
braces<code>[]</code> = array, curly braces <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code> = object. So
its definitely not of type string. So lets see what happens we when go
to validate the metadata.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_package_error_lang_json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">data_package_error_lang</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lang_issue</span> <span class="op">&lt;-</span> <span class="fu">wdds_validator</span><span class="op">(</span><span class="va">data_package_error_lang_json</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">errors_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">lang_issue</span><span class="op">)</span><span class="op">$</span><span class="va">errors</span></span>
<span></span>
<span><span class="va">errors_df</span></span>
<span><span class="co">#&gt;                 instancePath</span></span>
<span><span class="co">#&gt; 1 /project_metadata/language</span></span>
<span><span class="co">#&gt;                                              schemaPath keyword   type</span></span>
<span><span class="co">#&gt; 1 datacite/datacite-v4.5.json#/properties/language/type    type string</span></span>
<span><span class="co">#&gt;          message schema parentSchema.type</span></span>
<span><span class="co">#&gt; 1 must be string string            string</span></span>
<span><span class="co">#&gt;                                                                                     parentSchema.$comment</span></span>
<span><span class="co">#&gt; 1 Primary language of the resource. Allowed values are taken from  IETF BCP 47, ISO 639-1 language codes.</span></span>
<span><span class="co">#&gt;         data                   dataPath</span></span>
<span><span class="co">#&gt; 1 en, fr, cn /project_metadata/language</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="excuse-me-what-does-this-mean">Excuse me? What does this mean?<a class="anchor" aria-label="anchor" href="#excuse-me-what-does-this-mean"></a>
</h3>
<ul>
<li>
<strong>instancePath</strong> = where did the schema find an
error?</li>
<li>
<strong>schemaPath</strong> = where does the property come
from?</li>
<li>
<strong>keyword</strong> = what kind of violation occurred?</li>
<li>
<strong>message</strong> = what went wrong?</li>
<li>
<strong>params</strong> = what are the parameters for that property
in the schema?</li>
<li>
<strong>schema</strong> = what should be in that property?</li>
<li>
<strong>parentSchema</strong> = type and description from the
schemaPath</li>
<li>
<strong>data</strong> = violating item you provided</li>
<li>
<strong>dataPath</strong> = where did the violation occur?</li>
</ul>
<p>SO to interpret our error its really helpful to start by looking at
the <code>instancePath</code>, <code>keyword</code>, and
<code>message</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">errors_df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"instancePath"</span>,<span class="st">"keyword"</span>,<span class="st">"message"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                 instancePath keyword        message</span></span>
<span><span class="co">#&gt; 1 /project_metadata/language    type must be string</span></span></code></pre></div>
<p>OH project metadata must be type string! You will notice that it does
not tell you how it interpreted the object. You can figure this out by
converting <code>errors_df$data</code> to json.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">errors_df</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "language": "en"</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "language": "fr"</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   {</span></span>
<span><span class="co">#&gt;     "language": "cn"</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; ]</span></span></code></pre></div>
<p>This is obviously not a string!</p>
</div>
<div class="section level3">
<h3 id="how-do-i-correct-this-error">How do I correct this error?<a class="anchor" aria-label="anchor" href="#how-do-i-correct-this-error"></a>
</h3>
<p>Since our work is multi-lingual, we might think that
<code>c("en","fr","cn")</code> would be appropriate but that would be
converted to an <code>array</code> in JSON.</p>
<p>lets try just <code>"en, fr, cn"</code> and see if that works</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_package_correct_lang</span> <span class="op">&lt;-</span> <span class="va">data_package_error_lang</span></span>
<span></span>
<span><span class="va">data_package_correct_lang</span><span class="op">$</span><span class="va">project_metadata</span><span class="op">$</span><span class="va">language</span> <span class="op">&lt;-</span> <span class="st">"en, fr, cn"</span></span>
<span></span>
<span><span class="va">data_package_correct_lang_json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">data_package_correct_lang</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">correct_lang_issue</span> <span class="op">&lt;-</span> <span class="fu">wdds_validator</span><span class="op">(</span><span class="va">data_package_correct_lang_json</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">correct_lang_issue</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"WHAT! I gave it a string!?"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "WHAT! I gave it a string!?"</span></span></code></pre></div>
<p>Yes you did! BUT if we take a peek at the json object we can see that
your string was converted to the array
<code>"language": ["en, fr, cn"]</code>.</p>
<p>Why? because jsonlite errors on the side of wrapping things in
arrays.</p>
<p>Thankfully the authors of this package have provided methods for
preparing items! Here we will use <code>prep_language</code> when we add
the item. Prep_language is a thin wrapper around
<code>prep_atomic</code> - which ensures that jsonlite will interpret
your R object as numeric, string, boolean, or NULL.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_package_correct_lang</span> <span class="op">&lt;-</span> <span class="va">data_package_error_lang</span></span>
<span></span>
<span><span class="va">data_package_correct_lang</span><span class="op">$</span><span class="va">project_metadata</span><span class="op">$</span><span class="va">language</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prep_language.html">prep_language</a></span><span class="op">(</span><span class="st">"en, fr, cn"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">data_package_correct_lang_json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">data_package_correct_lang</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span> <span class="fu">wdds_validator</span><span class="op">(</span><span class="va">data_package_correct_lang_json</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="best-practices-for-free-text-fields">Best practices for free text fields<a class="anchor" aria-label="anchor" href="#best-practices-for-free-text-fields"></a>
</h2>
<p>We recommend that data producers use controlled vocabularies or
ontologies when filling out free text fields. We recognize that
selecting an appropriate vocabulary can be challenging and recommend the
following platforms for finding appropriate terms.</p>
<p>Recommended ontology hosting and search platforms with distinct
funding sources. Name | URL – | – Ontobee | <a href="https://ontobee.org/" class="external-link uri">https://ontobee.org/</a>
Ontology Lookup Service | <a href="https://www.ebi.ac.uk/ols4/" class="external-link uri">https://www.ebi.ac.uk/ols4/</a> BioPortal | <a href="https://bioportal.bioontology.org/" class="external-link uri">https://bioportal.bioontology.org/</a></p>
<p>All three platforms allow users to search for terms stored in
ontologies, explore relationships between terms, and find analogues. A
user will have to explore a given ontology to find the most appropriate
term. In Table S2 we list specific ontologies or authorities that may be
appropriate for a given field.</p>
<p>Recommended ontologies or authorities for specific fields. Field |
URL – | – Host Identification | <a href="https://www.gbif.org/species/search" class="external-link uri">https://www.gbif.org/species/search</a> Gene Target | <a href="https://www.ebi.ac.uk/ols4/ontologies/go" class="external-link uri">https://www.ebi.ac.uk/ols4/ontologies/go</a> Sample
Collection Method | <a href="http://purl.obolibrary.org/obo/OBI_0000659" class="external-link uri">http://purl.obolibrary.org/obo/OBI_0000659</a> Sample
Collection Body Part | <a href="https://www.ebi.ac.uk/ols4/ontologies/uberon" class="external-link uri">https://www.ebi.ac.uk/ols4/ontologies/uberon</a> Sample
Collection Material | <a href="http://purl.obolibrary.org/obo/OBI_0001479" class="external-link uri">http://purl.obolibrary.org/obo/OBI_0001479</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Collin Schwantes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
