<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Project Metadata • wddsWizard</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Project Metadata">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">wddsWizard</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/disease_data.html">Wildlife Disease Data</a></li>
    <li><a class="dropdown-item" href="../articles/project_metadata.html">Project Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/whole_game.html">The Whole Game</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Project Metadata</h1>
            
      

      <div class="d-none name"><code>project_metadata.Rmd</code></div>
    </div>

    
    
<p>In this vignette we will ingest project metadata from a CSV,
restructure the data, and then create a json object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://viralemergence.github.io/wddsWizard/">wddsWizard</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-in-the-csv-and-clean-it-up">Load in the CSV and clean it up<a class="anchor" aria-label="anchor" href="#load-in-the-csv-and-clean-it-up"></a>
</h2>
<p>Our example data requires some light cleaning to make transforming it
into csv easier.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">project_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"../inst/extdata/example_data/example_project_metadata.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## turn empty strings into NAs in the group field</span></span>
<span><span class="va">project_metadata</span> <span class="op">&lt;-</span> <span class="va">project_metadata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">Group</span> <span class="op">!=</span> <span class="st">""</span> <span class="op">~</span> <span class="va">Group</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## use `fill` to complete the items column and `mutate` to make groups a little</span></span>
<span><span class="co">## more ergonomic</span></span>
<span></span>
<span> <span class="va">project_metadata_filled</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/fill.html" class="external-link">fill</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">project_metadata</span>,<span class="va">Group</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="restructure-data">Restructure data<a class="anchor" aria-label="anchor" href="#restructure-data"></a>
</h2>
<p>The validation schema is expecting JSON, so we have to restructure
the data into a list that can be converted to JSON.</p>
<p>For Creators, Resources, and Funding References, its possible to have
multiple entities in each group. In our example data, there are two
creators and three funding references. So we need to pull out the
<code>entity_id</code>s for the creators and funding references then
clean up the <code>Group</code> field so it can be used a general
category for Creators, Resources, and Funding References.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># get ids for components of a group.</span></span>
<span><span class="va">project_metadata_ids</span> <span class="op">&lt;-</span> <span class="va">project_metadata_filled</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    entity_id <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">Group</span>,pattern <span class="op">=</span> <span class="st">"[0-9]"</span><span class="op">)</span>,</span>
<span>    <span class="co"># make sure that there are no NA entity IDs</span></span>
<span>    entity_id <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">entity_id</span><span class="op">)</span> <span class="op">~</span> <span class="st">"1"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">entity_id</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># drop entity ids from group field and convert to camel case</span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Group <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">Group</span>,pattern <span class="op">=</span> <span class="st">" [0-9]"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                 Group <span class="op">=</span> <span class="fu">snakecase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/snakecase/man/caseconverter.html" class="external-link">to_lower_camel_case</a></span><span class="op">(</span><span class="va">Group</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span> <span class="co">## split dataframe by Group for further processing</span></span>
<span> </span>
<span><span class="va">project_metadata_list</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">project_metadata_ids</span>,<span class="va">project_metadata_ids</span><span class="op">$</span><span class="va">Group</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># The `get_entity` function creates standard entities that will be easier to transform json</span></span>
<span></span>
<span><span class="va">project_metadata_list_entities</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">project_metadata_list</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">entity_id</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_entity.html">get_entity</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">x_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span><span class="op">$</span><span class="va">entity_id</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">x_list</span>, <span class="va">get_entity</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="make-the-json">Make the json!<a class="anchor" aria-label="anchor" href="#make-the-json"></a>
</h2>
<p>In a simpler world - you could just run the following code and it
would work.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## if only, if only the mockingbird sings</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">project_metadata_list_entities</span>,pretty <span class="op">=</span> <span class="cn">TRUE</span>,dataframe <span class="op">=</span> <span class="st">"columns"</span><span class="op">)</span></span></code></pre></div>
<p>BUT because datacite’s structures are more complex, we need to do
some prep. Luckily, there are a host of prep functions that already
exist in this package! These mostly tag list items with
<code><a href="https://jeroen.r-universe.dev/jsonlite/reference/unbox.html" class="external-link">jsonlite::unbox</a></code> and/or wrap things in lists so that when
converted to json, they match the data standard’s expected formats.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prep_for_json.html">prep_for_json</a></span><span class="op">(</span><span class="va">project_metadata_list_entities</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span>pretty  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "creators": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "name": "Daniel J. Becker",</span></span>
<span><span class="co">#&gt;         "givenName": "Daniel J.",</span></span>
<span><span class="co">#&gt;         "familyName": "Becker",</span></span>
<span><span class="co">#&gt;         "affiliation": [</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "name": "Department of Biology, University of Oklahoma, Norman, OK, USA",</span></span>
<span><span class="co">#&gt;             "affiliationIdentifier": "https://ror.org/02aqsxs83"</span></span>
<span><span class="co">#&gt;           }</span></span>
<span><span class="co">#&gt;         ],</span></span>
<span><span class="co">#&gt;         "nameIdentifiers": [</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "nameIdentifier": "https://orcid.org/0000-0003-4315-8628",</span></span>
<span><span class="co">#&gt;             "nameIdentifierScheme": "ORCID"</span></span>
<span><span class="co">#&gt;           }</span></span>
<span><span class="co">#&gt;         ]</span></span>
<span><span class="co">#&gt;       },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "name": "Guang-Sheng Lei",</span></span>
<span><span class="co">#&gt;         "givenName": "Guang-Sheng",</span></span>
<span><span class="co">#&gt;         "familyName": "Lei",</span></span>
<span><span class="co">#&gt;         "affiliation": [</span></span>
<span><span class="co">#&gt;           {</span></span>
<span><span class="co">#&gt;             "name": "Department of Pathology and Laboratory Medicine, Indiana University School of Medicine, Indianapolis, IN, USA",</span></span>
<span><span class="co">#&gt;             "affiliationIdentifier": "https://ror.org/02ets8c94"</span></span>
<span><span class="co">#&gt;           }</span></span>
<span><span class="co">#&gt;         ]</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "descriptions": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "description": "Bats can harbor many pathogens without showing disease…",</span></span>
<span><span class="co">#&gt;         "descriptionType": "Abstract"</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "fundingReferences": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "funderName": "National Geographic Society",</span></span>
<span><span class="co">#&gt;         "funderIdentifier": "http://dx.doi.org/10.13039/100006733",</span></span>
<span><span class="co">#&gt;         "awardNumber": "NGS-55503R-19"</span></span>
<span><span class="co">#&gt;       },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "funderName": "Indiana University",</span></span>
<span><span class="co">#&gt;         "funderIdentifier": "http://dx.doi.org/10.13039/100006733"</span></span>
<span><span class="co">#&gt;       },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "funderName": "College of Charleston",</span></span>
<span><span class="co">#&gt;         "funderIdentifier": "http://dx.doi.org/10.13039/100009789"</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "identifiers": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "identifier": "https://www.ebi.ac.uk/pride/archive/projects/PXD031075"</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "language": "en",</span></span>
<span><span class="co">#&gt;   "methodology": {</span></span>
<span><span class="co">#&gt;     "eventBased": false,</span></span>
<span><span class="co">#&gt;     "archival": false</span></span>
<span><span class="co">#&gt;   },</span></span>
<span><span class="co">#&gt;   "publicationYear": "2022",</span></span>
<span><span class="co">#&gt;   "rights": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "rights": "CC0"</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "subjects": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "subject": "Proteomics"</span></span>
<span><span class="co">#&gt;       },</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "subject": "Immune Response"</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;   ],</span></span>
<span><span class="co">#&gt;   "titles": [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;       "title": "Serum proteomics of coronavirus shedding in vampire bats (Desmodus rotundus)"</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   ]</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Collin Schwantes.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
